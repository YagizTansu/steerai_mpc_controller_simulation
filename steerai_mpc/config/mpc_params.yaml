# MPC Controller Configuration Parameters
# This file contains all configurable parameters for the Model Predictive Controller

# ============================================================================
# SOLVER SELECTION
# Choose between Acados (fast) or CasADi IPOPT (fallback)
# ============================================================================
# Enable/disable acados solver
# Set to true to use high-performance acados solver (10-100x faster)
# Set to false to use traditional CasADi + IPOPT solver
# Default: true
use_acados: true


# ============================================================================
# VEHICLE CONSTRAINTS
# Physical limits of the POLARIS GEM e2 vehicle
# ============================================================================
vehicle:
  # Maximum velocity (m/s)
  # Range: 0.1 - 10.0
  # Default: 5.556 m/s (exactly 20 km/h - project requirement)
  # Higher values allow faster driving but may reduce control accuracy
  # Maximum velocity (m/s)
  # Range: 0.1 - 10.0
  # Default: 5.556 m/s (exactly 20 km/h - project requirement)
  # Higher values allow faster driving but may reduce control accuracy
  v_max: 5.40
  
  # Maximum steering angle (radians)
  # Range: 0.1 - 1.5 rad
  # Default: 0.6 rad (~34 degrees)
  # This limits how sharply the vehicle can turn
  delta_max: 0.6

# ============================================================================
# MPC PARAMETERS
# Model Predictive Control horizon and time discretization
# ============================================================================
mpc:
  # Prediction horizon (number of steps)
  # Range: 5 - 50
  # Default: 15 steps (balanced for CTE constraint)
  # Longer horizon = better long-term planning but slower solver
  # With dt=0.1, T=15 means 1.5 second lookahead
  # CRITICAL: Reduced for CTE constraint computational load
  horizon: 15

  # Time step (seconds)
  # Range: 0.01 - 0.5
  # Default: 0.1 seconds (10 Hz)
  # Smaller dt = more accurate but more computation
  dt: 0.1

# ============================================================================
# COST FUNCTION WEIGHTS
# These weights determine the relative importance of different objectives
# Higher weight = MPC tries harder to minimize that error
# ============================================================================
weights:
  # Position error weight
  # Range: 0.0 - 100.0
  # Default: 6.0
  # Penalizes deviation from reference path (cross-track error)
  # Too high: aggressive path following, can cause oscillations in turns
  # Too low: vehicle may drift away from path
  # SMOOTH: Reduced to prevent micro-corrections
  position: 6.0
  
  # Heading error weight
  # Range: 0.0 - 100.0
  # Default: 8.0
  # Penalizes vehicle heading misalignment with path direction
  # Too high: vehicle rigidly follows path orientation, may cause jerky motion
  # Too low: vehicle may not align properly with path, especially in curves
  # SMOOTH: Increased for stable heading control
  heading: 8.0
  
  # Velocity error weight
  # Range: 0.0 - 100.0
  # Default: 0.5
  # Penalizes deviation from target speed
  # Too high: aggressive speed tracking, may sacrifice path following
  # Too low: vehicle may not reach target speed
  velocity: 0.5
  
  # Steering smoothness weight
  # Range: 0.0 - 100.0
  # Default: 80.0
  # Penalizes rapid changes in steering commands (delta_steering)
  # Too high: very smooth but slow steering response, may miss sharp turns
  # Too low: jerky steering, can cause instability
  # SMOOTH: Very high (80) to eliminate steering chatter completely
  steering_smooth: 80.0
  
  # Acceleration smoothness weight
  # Range: 0.0 - 100.0
  # Default: 5.0
  # Penalizes rapid changes in velocity commands (delta_velocity)
  # Too high: very smooth acceleration/braking but slow speed changes
  # Too low: jerky speed changes, uncomfortable ride
  acceleration_smooth: 5.0

# ============================================================================
# SOLVER PARAMETERS (IPOPT)
# Settings for the numerical optimization solver
# Adjust these to balance solution quality vs computation time
# ============================================================================
solver:
  # Maximum number of iterations
  # Range: 10 - 2000
  # Default: 150
  # More iterations = higher chance of finding optimal solution but slower
  # CRITICAL: Reduced for CTE constraint to prevent timeout
  max_iter: 150
  
  # Print level (console output verbosity)
  # 0 = silent, 5 = very verbose
  # Default: 0 (silent)
  # Set to 5 for debugging solver issues
  print_level: 0
  
  # Optimality tolerance
  # Range: 1e-6 - 1.0
  # Default: 1.0 (maximum relaxation for CTE constraint)
  # Lower = more accurate but slower
  # Higher = faster but less accurate
  # CRITICAL: Maximum relaxation for CTE constraint
  tol: 1.0
  
  # Acceptable tolerance (backup stopping criterion)
  # Range: 1e-6 - 1.0
  # Default: 1.5 (maximum relaxation)
  # If this tolerance is reached for acceptable_iter iterations, solver stops
  acceptable_tol: 1.0
  
  # Acceptable iterations
  # Range: 1 - 50
  # Default: 1
  # Number of iterations at acceptable_tol before declaring success
  # CRITICAL: Single iteration acceptance for speed
  acceptable_iter: 1
  
  # Maximum CPU time per solve (seconds)
  # Range: 0.01 - 1.0
  # Default: 0.095 (95ms - allowing margin for CTE constraint)
  # CRITICAL: Increased for CTE constraint complexity
  max_cpu_time: 0.095

# ============================================================================
# CONTROL PARAMETERS
# Behavior settings for the controller
# ============================================================================
control:
  # Target cruising speed (m/s)
  # Range: 0.1 - 8.0
  # Default: 5.556 m/s (20 km/h - project requirement)
  # This is the desired speed the MPC will try to maintain
  # Note: Must be <= v_max (vehicle constraint)
  target_speed: 5.56
  
  # Goal reached tolerance (meters)
  # Range: 0.1 - 2.0
  # Default: 0.5 m
  # Distance to final waypoint where vehicle stops
  goal_tolerance: 0.5
  
  # Control loop frequency (Hz)
  # Range: 1 - 50
  # Default: 10 Hz
  # How often MPC solver runs and publishes commands
  # Must be compatible with solver max_cpu_time
  loop_rate: 10

# ============================================================================
# ACADOS SOLVER PARAMETERS
# High-performance optimization solver settings
# ============================================================================
acados:
  # Solver type
  # Options: 'SQP' (Sequential Quadratic Programming) or 'SQP_RTI' (Real-Time Iteration)
  # Default: 'SQP_RTI'
  # RTI provides guaranteed real-time performance with single iteration per solve
  solver_type: 'SQP_RTI'
  
  # QP (Quadratic Programming) solver
  # Options: 'PARTIAL_CONDENSING_HPIPM', 'FULL_CONDENSING_QPOASES', 'FULL_CONDENSING_HPIPM'
  # Default: 'PARTIAL_CONDENSING_HPIPM' (fastest for medium-sized problems)
  # HPIPM is optimized for embedded systems and real-time applications
  qp_solver: 'PARTIAL_CONDENSING_HPIPM'
  
  # Maximum QP solver iterations
  # Range: 10 - 500
  # Default: 50
  # More iterations = higher accuracy but slower
  qp_solver_iter_max: 50
  
  # Hessian approximation method
  # Options: 'GAUSS_NEWTON' or 'EXACT'
  # Default: 'GAUSS_NEWTON'
  # Gauss-Newton is faster and works well for least-squares problems
  hessian_approx: 'GAUSS_NEWTON'
  
  # Integrator type
  # Options: 'ERK' (Explicit Runge-Kutta), 'IRK' (Implicit RK), 'DISCRETE'
  # Default: 'DISCRETE'
  # We use discrete-time model (neural network already provides x_next)
  integrator_type: 'DISCRETE'
  
  # Maximum NLP (Nonlinear Programming) solver iterations
  # Range: 1 - 100
  # Default: 1 (for RTI mode)
  # RTI mode uses single iteration for real-time guarantee
  nlp_solver_max_iter: 1
  
  # Globalization strategy (only for SQP, not SQP_RTI)
  # Options: 'MERIT_BACKTRACKING', 'FIXED_STEP'
  # Default: 'MERIT_BACKTRACKING'
  # Helps with convergence when optimization landscape is difficult
  globalization: 'MERIT_BACKTRACKING'
  
  # Code export directory
  # Directory where acados generates C code
  # Default: 'c_generated_code'
  code_export_dir: 'c_generated_code'
  
  # Code generation and compilation (advanced)
  # Set to true to compile and use generated C code (faster execution)
  # Set to false for easier debugging and development
  # Default: false
  code_export: false

